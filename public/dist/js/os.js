var app=angular.module("cloudboxes",[]);app.factory("AccountService",function(a,b){var c=!1;return{isLoggedIn:function(){return c},login:function(e,f){a.getCB().modules.Authentication.dologin(e,f,function(a){c=a;b.hideOverlay("login")})}}});app.factory("OverlayService",function(a){var b={login:!1};a.overlays=b;return{showOverlay:function(c){a.$apply(function(){b[c]=!0})},hideOverlay:function(a){b[a]=!1}}});app.factory("OsService",function(){var a=null;return{getCB:function(){return a},startCB:function(){a=new CloudBoxes}}});app.controller("login",function(a,b,c){a.tryLogin=function(a,c){b.login(a,c)}});app.run(function(a){a.startCB()});function CloudBoxes(){this.version=.1;this.socket=null;this.modules={};this.OsCanvas=this.buildCanvas();this.connectServer()}CloudBoxes.prototype.loadModules=function(){};CloudBoxes.prototype.buildCanvas=function(){return new OsCanvas};CloudBoxes.prototype.loadModule=function(a){this.modules[a]=new window[a](this);this.modules[a].init()};CloudBoxes.prototype.connectServer=function(){var a=this;this.socket=io(top.location.origin);this.socket.on("serverlive",function(){a.loadModule("Authentication")});this.socket.on("serveroffline",function(){})};function OsCanvas(){this.canvas=document.getElementById("oscanvas");this.ctx=this.canvas.getContext("2d");this.buildSize();this.registerResize();this.canvasObjects=[];this.startDrawing();return this}OsCanvas.prototype.buildSize=function(){this.canvas.width=document.body.clientWidth;this.canvas.height=document.body.clientHeight};OsCanvas.prototype.registerResize=function(){var a=this;window.onresize=function(b){a.buildSize();for(b=0;b<a.canvasObjects.length;b++)a.canvasObjects[b].resized()}};OsCanvas.prototype.startDrawing=function(){var a=this,b=function(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height);for(var c=0;c<a.canvasObjects.length;c++)a.canvasObjects[c].draw();window.requestAnimationFrame(b)};window.requestAnimationFrame(b)};OsCanvas.prototype.createImg=function(a){a=new Img(a,this);this.canvasObjects.push(a);return a};OsCanvas.prototype.createText=function(a){};OsCanvas.prototype.requestFullScreen=function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};function Authentication(a){this.CloudBoxes=a}Authentication.prototype.init=function(){angular.element(document.getElementById("overlay")).injector().get("OverlayService").showOverlay("login")};Authentication.prototype.dologin=function(a,b,c){this.startLoginAnimation();c(!0)};Authentication.prototype.startLoginAnimation=function(){var a=this.CloudBoxes.OsCanvas.createImg("/img/logo.png");a.on("load",function(){a.centerImg();var b=a.position.top;a.position.top=0-a.position.height;a.animateMove(a.position.left,a.position.top,a.position.left,b,500,0)})};function Img(a,b){var c=this;this.oscanvas=b;this.img=new Image;this.img.src=a;this.animationMoveFrame=void 0;this.img.onload=function(){c.position.width=c.img.width;c.position.height=c.img.height;c.loaded=!0;c.fireEvent("load")};this.loaded=!1;this.position={left:0,top:0,width:this.img.width,height:this.img.height,refWidth:this.oscanvas.canvas.width,refHeight:this.oscanvas.canvas.height};this.eventsList=[]}Img.prototype.on=function(a,b){this.eventsList.push({event:a,callback:b})};Img.prototype.resized=function(){this.position.left=this.oscanvas.canvas.width*this.position.left/this.position.refWidth;this.position.top=this.oscanvas.canvas.height*this.position.top/this.position.refHeight;this.position.refWidth=this.oscanvas.canvas.width;this.position.refHeight=this.oscanvas.canvas.height};Img.prototype.fireEvent=function(a){for(var b=0;b<this.eventsList.length;b++)this.eventsList[0].event==a&&this.eventsList[0].callback(this)};Img.prototype.animateMove=function(a,b,c,e,f,d,h){var g=this,m=Date.now()+(d?d:0),n=a-c,p=b-e,l=function(){var d=Date.now()-m,k=d/f;g.position.left=a-n*k;g.position.top=b-p*k;d>f?(g.position.left=c,g.position.top=e,h?h():""):window.requestAnimationFrame(l)};setTimeout(l,d?d:0)};Img.prototype.centerImg=function(){var a=this,b=function(){!1==a.loaded?setTimeout(b,0):(a.position.left=a.oscanvas.canvas.width/2-a.img.width/2,a.position.top=a.oscanvas.canvas.height/2-a.img.height/2)};b()};Img.prototype.draw=function(){this.loaded&&this.oscanvas.ctx.drawImage(this.img,this.position.left,this.position.top,this.position.width,this.position.height)};